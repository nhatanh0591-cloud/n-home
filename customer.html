<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-Home Customer App</title>
    <link rel="manifest" href="/manifest-customer.json">
    <meta name="theme-color" content="#16a34a">
    <link rel="icon" href="/icon-nen-xanh.jpg">
</head>
<body>
    <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background: #f3f4f6; font-family: Arial, sans-serif;">
        <div style="text-align: center; padding: 40px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 400px;">
            <img src="/icon-nen-xanh.jpg" style="width: 80px; height: 80px; border-radius: 12px; margin-bottom: 20px;">
            <h1 style="color: #1f2937; margin-bottom: 10px;">N-Home Customer</h1>
            <p style="color: #6b7280; margin-bottom: 30px;">·ª®ng d·ª•ng kh√°ch h√†ng N-Home</p>
            <button onclick="redirectToApp()" style="background: #16a34a; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; cursor: pointer;">
                M·ªü ·ª®ng D·ª•ng
            </button>
        </div>
    </div>

    <script>
        // FORCE SHOW INSTALL POPUP NGAY L·∫¨P T·ª®C
        let deferredPrompt;

        // Redirect to main app
        function redirectToApp() {
            window.location.href = '/app';
        }

        // PWA Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('üî• CUSTOMER.HTML - beforeinstallprompt fired!');
            e.preventDefault();
            deferredPrompt = e;
            showInstallPopup();
        });

        // FORCE SHOW POPUP
        function showInstallPopup() {
            const popup = document.createElement('div');
            popup.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; padding: 30px; margin: 20px; max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                        <div style="width: 60px; height: 60px; margin: 0 auto 20px; background-image: url('/icon-nen-xanh.jpg'); background-size: cover; border-radius: 12px;"></div>
                        <h3 style="margin: 0 0 10px 0; font-size: 20px; font-weight: bold; color: #1f2937;">üî• C√ÄI N-HOME APP</h3>
                        <p style="margin: 0 0 25px 0; color: #6b7280; font-size: 15px;">C√†i ƒë·∫∑t app ƒë·ªÉ s·ª≠ d·ª•ng d·ªÖ d√†ng h∆°n!</p>
                        <div style="display: flex; gap: 15px;">
                            <button onclick="installApp()" style="flex: 1; background: #16a34a; color: white; border: none; padding: 15px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px;">C√ÄI ƒê·∫∂T</button>
                            <button onclick="closePopup()" style="flex: 1; background: #f3f4f6; color: #6b7280; border: none; padding: 15px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px;">B·ªé QUA</button>
                        </div>
                    </div>
                </div>
            `;
            popup.id = 'install-popup';
            document.body.appendChild(popup);
        }

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('Install outcome:', outcome);
                deferredPrompt = null;
            } else {
                alert('üì± H∆Ø·ªöNG D·∫™N C√ÄI ƒê·∫∂T:\n\n' +
                      'üîπ Chrome: Menu (‚ãÆ) ‚Üí "Th√™m v√†o m√†n h√¨nh ch√≠nh"\n' +
                      'üîπ Safari: Share (üì§) ‚Üí "Add to Home Screen"\n' +
                      'üîπ Edge: Menu (‚ãØ) ‚Üí "C√†i ƒë·∫∑t ·ª©ng d·ª•ng n√†y"');
            }
            closePopup();
        }

        function closePopup() {
            const popup = document.getElementById('install-popup');
            if (popup) {
                popup.remove();
            }
        }

        // FORCE SHOW on mobile
        function isMobile() {
            return /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Show popup after 1 second
        setTimeout(() => {
            if (isMobile()) {
                console.log('üî• FORCE SHOWING INSTALL POPUP ON MOBILE!');
                showInstallPopup();
            }
        }, 1000);

        // Service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/customer-sw.js')
                .then(reg => console.log('SW registered:', reg))
                .catch(err => console.log('SW error:', err));
        }
    </script>
</body>
</html>